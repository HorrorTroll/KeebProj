# Rhymestone ビルドガイド

- [Rhymestone ビルドガイド](#rhymestone-%E3%83%93%E3%83%AB%E3%83%89%E3%82%AC%E3%82%A4%E3%83%89)
  - [パーツ一覧](#%E3%83%91%E3%83%BC%E3%83%84%E4%B8%80%E8%A6%A7)
    - [キット付属品](#%E3%82%AD%E3%83%83%E3%83%88%E4%BB%98%E5%B1%9E%E5%93%81)
    - [キット以外に必要なもの](#%E3%82%AD%E3%83%83%E3%83%88%E4%BB%A5%E5%A4%96%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE)
  - [必要な道具](#%E5%BF%85%E8%A6%81%E3%81%AA%E9%81%93%E5%85%B7)
  - [作業手順](#%E4%BD%9C%E6%A5%AD%E6%89%8B%E9%A0%86)
  - [Pro Microの準備](#pro-micro%E3%81%AE%E6%BA%96%E5%82%99)
    - [もげ対策！](#%E3%82%82%E3%81%92%E5%AF%BE%E7%AD%96)
    - [ファームウェアを書き込む](#%E3%83%95%E3%82%A1%E3%83%BC%E3%83%A0%E3%82%A6%E3%82%A7%E3%82%A2%E3%82%92%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%82%80)
  - [Pro Microにピンヘッダをはんだ付けする](#pro-micro%E3%81%AB%E3%83%94%E3%83%B3%E3%83%98%E3%83%83%E3%83%80%E3%82%92%E3%81%AF%E3%82%93%E3%81%A0%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B)
  - [ダイオードをはんだ付けする](#%E3%83%80%E3%82%A4%E3%82%AA%E3%83%BC%E3%83%89%E3%82%92%E3%81%AF%E3%82%93%E3%81%A0%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B)
  - [*(オプション)LEDをはんだ付けする*](#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3led%E3%82%92%E3%81%AF%E3%82%93%E3%81%A0%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B)
  - [*(オプション)OLED用のピンソケット・ピンヘッダをはんだ付けする*](#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3oled%E7%94%A8%E3%81%AE%E3%83%94%E3%83%B3%E3%82%BD%E3%82%B1%E3%83%83%E3%83%88%E3%83%BB%E3%83%94%E3%83%B3%E3%83%98%E3%83%83%E3%83%80%E3%82%92%E3%81%AF%E3%82%93%E3%81%A0%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B)
  - [TRRSコネクタ、タクトスイッチをはんだ付けする](#trrs%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E3%82%BF%E3%82%AF%E3%83%88%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%82%92%E3%81%AF%E3%82%93%E3%81%A0%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B)
  - [トッププレートにスイッチをはめ込む](#%E3%83%88%E3%83%83%E3%83%97%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%AB%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%82%92%E3%81%AF%E3%82%81%E8%BE%BC%E3%82%80)
  - [MXソケットをはんだ付けする](#mx%E3%82%BD%E3%82%B1%E3%83%83%E3%83%88%E3%82%92%E3%81%AF%E3%82%93%E3%81%A0%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B)
  - [スペーサーの取り付け](#%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B5%E3%83%BC%E3%81%AE%E5%8F%96%E3%82%8A%E4%BB%98%E3%81%91)
  - [保護パネルの取り付け](#%E4%BF%9D%E8%AD%B7%E3%83%91%E3%83%8D%E3%83%AB%E3%81%AE%E5%8F%96%E3%82%8A%E4%BB%98%E3%81%91)
  - [キーキャップの取り付け](#%E3%82%AD%E3%83%BC%E3%82%AD%E3%83%A3%E3%83%83%E3%83%97%E3%81%AE%E5%8F%96%E3%82%8A%E4%BB%98%E3%81%91)
  - [キーボードファームウェアの書き込み](#%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%83%95%E3%82%A1%E3%83%BC%E3%83%A0%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF)
  - [テスト](#%E3%83%86%E3%82%B9%E3%83%88)
  - [完成！](#%E5%AE%8C%E6%88%90)

## パーツ一覧

### キット付属品

| 名前 | 数 | 備考 |
| ---- | ---- | --- |
| PCB | 2枚 | |
| トッププレート | 2枚 | 四角い穴がいっぱい空いたほうです |
| ボトムプレート | 2枚 | |
| OLED・Pro Micro保護プレート | 2枚 | |
| M2スペーサー 8mm | 12個 | |
| プラスペーサー 3mm | 8個 | M2スペーサーと組み合わせて使います |
| M2ネジ 5mm | 20個 | |
| M2黒皿ネジ 4mm| 4個 | 保護プレートに取り付けるネジです |
| ゴム足 | 8個 | 大小4個ずつ |
| ダイオード | 40個 |  |
| TRRSジャック | 2個 | |
| タクトスイッチ | 2個 | |

### キット以外に必要なもの

| 名前 | 数 | 備考 |
| ---- | ---- | --- |
| 3.5mmステレオケーブル(3極) | 1本 | キーボード間接続用 |
| MicroUSBケーブル | 1本 | キーボードとPC接続用 |
| キースイッチ | 40個 | MX互換のもの |
| キーキャップ | 40個 | MX互換のもの |
| Pro Micro | 2個 | |
| スプリングピンヘッダ 12P | 4個 | 交換や確認にも便利なので必須と言っていいくらい推奨 |
| MXソケット | 40個 | MXスイッチ用ソケット |
| *SK6812mini- | *40個- | *バックライト用（オプション）- |
| *OLEDモジュール- | *1～2個- | *OLED用（オプション）- |
| *ピンソケット 4P- | *1～2個- | *OLED用（オプション）- |
| *ピンヘッダ 4P- | *1～2個- | *OLED用（オプション）- |

## 必要な道具

| 名前 | 備考 |
| ---- | ---- |
| はんだごて | バックライトLEDを取り付ける場合は温度調整が出来るものが必須です<br/>(温度調整が出来ないとLED破損率がかなり高いです) |
| フラックス | バックライトLEDを取り付ける場合はあるとメッチャ捗るので必須です |
| 糸ハンダ | 0.8mm程度のものを推奨します |
| ニッパー | ダイオードのリード線などの切断用です |
| ピンセット | ProMicroリセットしたりチップLEDのはんだづけで使用します |
| マスキングテープ | 柄入りで可。パーツの仮止めに使用します |
| フラックス除去剤 | 必須ではありませんがはんだ付け後のベタつきを除去出来、はんだによる黄色い変色も拭き取れてキレイな仕上がりになります |
| マスキングテープ | しるし付け、仮固定に使用。100均の柄付きでもOK |

## 作業手順

1. Pro Microの準備
2. ダイオードをはんだ付けする
3. *(オプション)LEDをはんだ付けする*
4. *(オプション)OLED用のピンソケット・ピンヘッダをはんだ付けする*
5. TRRSコネクタ、タクトスイッチをはんだ付けする
6. トッププレートにスイッチをはめ込む
7. MXソケットをはんだ付けする
8. スペーサーの取り付け
9. ボトムプレートと保護パネルの取り付け
10. キーキャップの取り付け
11. キーボードファームウェアの書き込み
12. テスト

　組み立ての時間の目安として、LEDありで6～12時間、LEDなしで3～6時間くらい（ファーム開発環境構築からだと別途+1～2時間程度）はかかります。空いた時間にちょびちょび進めるか、休日一日ガッツリやるかで

## Pro Microの準備

　机に半田ごてを用意するその前に！Pro Microの準備を先にやってしまいましょう。  

### もげ対策！

　Pro Microに使用されているUSBコネクタはmicro USBで、それがほぼハンダで保持されている状態のため、付け外しを繰り返すとモゲてしまいます（界隈ではそうなったpro microは「moge micro」と呼んでいます）。そうなると面倒くさいので最初に手を打っておきます。[英さん](https://twitter.com/hdbx)の[ProMicroのモゲ防止ついでにQMK_Firmwareを書き込む](https://qiita.com/hdbx/items/2f3e4ddfcadda2a5578e)を見てやってみてください。  
　エポキシ接着剤を使った場合1～2時間程度で（室温・気温によりますが）触っても大丈夫くらいになると思います。乾くまで時間が少しかかるのでファームウェアの書き込み準備をします。もし準備が出来ているなら先のダイオードのはんだ付けに進んでも良いと思います。  

### ファームウェアを書き込む

　Pro Microに先にファームを書き込んでしまいます。はやる気持ちを抑えて最初にソフトウェアの準備と書き込みをしてしまえば、完成後すぐ使用できます。  
　オプションのLEDバックライトを取り付ける方は、LEDの点灯確認に使いますので必須項目です。  

　Winの方はMSYS2を使うか、WSL(Windows Subsystem for Linux)を使う方法があります。MSYS2での書き込み方は[さぼてんさん](https://twitter.com/cactusman)作成の記事[プログラマーではない人向けのQMK Firmware入門](https://qiita.com/cactusman/items/ac41993d1682c6d8a12e)を、WSLは[qmk_firmwareをWindows上でmakeする方法](https://qiita.com/marksard/items/f381caf3ca981f307f64)を参照してファームウェアを書き込める環境を作ってください。  
　Macな方はDocker使うほうが確実かもしれません。[自作キーボードに手を出した](https://poyo.hatenablog.jp/entry/2018/10/08/003800) の後半に記述があります。  

　Rhymestoneのデフォルトキーマップのmakeは ```make rhymestone:default``` で可能です。（MSYS2環境上なら ```make rhymestone:default:avrdude``` で書き込みも出来ます）  

　LEDの動作確認にはHelixキーボードのテスト用のものが使えます。 ```make helix:led_test``` したものを使います（MSYS2環境上なら ```make helix:led_test:avrdude``` で書き込みも出来ます）  

　Pro Microにリセットボタンはないので、Pro MicroのGNDピンとRSTピン（隣同士ならんでいます）をピンセットなどでショートさせてください。

## Pro Microにピンヘッダをはんだ付けする

　Pro Microにピンヘッダを取り付けます。大抵ProMicro買うとピンヘッダが付属しているから買わなくてもいいやって考えがちですが、ちょっとお高いコンスル―用スプリングピンヘッダにすると

- キーボード基板の裏表間違ってはんだ付けしてしまった時のリカバリ
- もげマイクロ対策
- Pro Microの文鎮化(異常なデータを書いた時)対策
- Pro Microを再利用可能

など、メリットしかないので超オススメします。  

　ピンヘッダの取り付けは[Helixベータ ビルドガイド](https://github.com/MakotoKurauchi/helix/blob/master/Doc/buildguide_jp.md)
が丁寧なのでこちらを参照ください。  

## ダイオードをはんだ付けする

1. ダイオードの脚を曲げる
2. 横並びに5つまとめてPCBに取り付ける
3. ハンダ付けする
4. 脚を切る

## *(オプション)LEDをはんだ付けする*

1. 向きを合わせる
1. 左手でピンセットでチップLEDつまんでPCBの穴にはめ込んで位置合わせ
1. つまんだまま右手でフラックスを塗る
1. 220度あたりに設定したハンダごてのこて先にハンダを少し付ける
1. ランド（銀色のトコロ）の一つにハンダごてをちょんと当てる
1. ハンダでチップLEDとPCBが付いたらピンセットを離す
1. 残りのランドに同じようにはんだする
1. 繰り返す

## *(オプション)OLED用のピンソケット・ピンヘッダをはんだ付けする*

　遊舎工房でOLEDを買う場合ピンソケット付きをオプションで選べます。AliExpressなどでOLEDだけ買った場合はピンソケットが無いので別途秋月電子かヒロスギネットなどで別途購入してください。

- 2.54mmピッチ  
- ロープロファイル（低背）基板取り付け高さ3.5mm  
- ピンソケット  
- 1x4(4P)  

のものを買ってください。  

　まっすぐラクに取り付けるため、マスキングテープでまっすぐつくように仮押さえしてから裏返してはんだ付けします。  

## TRRSコネクタ、タクトスイッチをはんだ付けする

　まっすぐラクに取り付けるため、マスキングテープでまっすぐつくように仮押さえしてから裏返してはんだ付けします。  
　タクトスイッチはパチッとはめ込んで裏返してはんだ付けします。  

## トッププレートにスイッチをはめ込む

　ソケットを先にはんだ付けしても良いのですが、先にトッププレートにスイッチを全部はめ込んで、ソケットを端子に差し込んだ後にハンダ付けしたほうが手早くキレイに取り付けられます。  
　お好みのスイッチをトッププレートにはめ込んでください。  

## MXソケットをはんだ付けする

　まずトッププレートとPCBを合わせます。スイッチ裏の中央の出っ張りをPCBの穴に合わせて取り付けてください。  
　MXソケットをPCBのシルクの白いマークに合わせて取り付けます。スイッチのピンがMXソケットにちゃんと刺さっている事を確認しながらパチパチと全部付けてください。  

　あとはハンダ付けです。MXソケットを取り付けると、スイッチの交換は可能になりますが、ソケットと基板の保持をハンダに頼っているため交換後スイッチが効かないなどのハンダ不良が発生する可能性があります。ただ厚く盛っても意味がないので、PCBとソケットの間にしっかりハンダを流します。  

　ハンダごてのこて先に気持ち多めにハンダを付けて、ソケットの金具の隙間に見えるPCBに付ける気持ちで、ソケットの隙間を少しこじ開ける感じで熱を与えながら流し込みます。  

## スペーサーの取り付け

　ボトムプレートの保護紙の片側を剥がし、剥がした方にゴム脚を取り付けてください。標準でチルトするように大きいものと小さいものが入っていますので、小さいほう二つを手前に、大きいほう二つを奥に貼り付けてください。  
　残りの保護紙も剥がして、8mmスペーサー4つと5mmネジを4つ使ってボトムプレートにねじ止めしてください。  
　ねじ止めしたら、3mmの樹脂スペーサーを8mmスペーサーに差し込んでおきます。この樹脂スペーサーはスイッチ交換時のPCB落ち込みを防止するために機能します。  

## 保護パネルの取り付け

　Pro Micro周りの目隠しとOLEDを保護するためのプレートを取り付けます。8mmスペーサー二つを5mmのネジでPCBに取り付けます。  
　プレートの保護紙を両方剥がして、黒の4mmネジでPCBに付けたスペーサーに取り付けてください。  
　少し遊びがありますので、キーキャップを取り付けた時にキーキャップと干渉する場合は少しずらしてください。  

## キーキャップの取り付け

　お好みのキーキャップを取り付けてください。  

## キーボードファームウェアの書き込み

　LEDバックライトのテストのためにled_testを書き込んでいた人は戻ってdefaultキーマップを書き込んでください。  

## テスト

　まず片方ずつPCに接続してテストしてください。片方づつ付けた場合は常に左手で認識するので、キーボードテスターアプリなどでキーが認識されているかチェックしてください。OLEDを取り付けている場合は、OLEDの四段目の表示がスイッチのステータスです。何かしら変化していればOKです。

　ProMicroとUSBを外しします。  
　左右をTRRSケーブルでつないで、左手側のProMicroとUSBを接続してPCに認識させます。  
　左右で通信が出来ているかチェックしてください。

## 完成！

　チェックして問題なさそうなら完成です！あなただけの一台に仕上げてください！
